<!DOCTYPE html>
<html>
<head lang="en">
    <meta charset="UTF-8">
    <title></title>
    <style>
        * {
            margin: 0px;
            padding: 0px;
        }

        #contenter {
            width: 660px;

        }

        #contenter img {
            width: 200px;
            height: 150px;
            margin: 10px;
            float: left;

        }

        #contenter img.selected {
            border: 1px dashed crimson;
        }
    </style>
</head>
<body>
<div id="contenter">
    <img src="images/1.jpg">
    <img src="images/2.jpg">
    <img src="images/3.jpg">
    <img src="images/4.jpg">
    <img src="images/5.jpg">
    <img src="images/6.jpg">
    <img src="images/7.jpg">
    <img src="images/8.jpg">
    <img src="images/9.jpg">
</div>
<script src="jslib.js"></script>
<script>
    var ocontenter = document.getElementById("contenter");
    var aImag = ocontenter.getElementsByTagName("img");
    for (var i = aImag.length - 1; i >= 0; i--) {
        aImag[i].pos = {
            left: aImag[i].offsetLeft,
            top: aImag[i].offsetTop
        }

        aImag[i].style.top = aImag[i].offsetTop + "px";
        aImag[i].style.left = aImag[i].offsetLeft + "px";

        aImag[i].style.position = "absolute";
        aImag[i].style.margin = 0;
        var collide = [];
        var izindex = 1;
        drag(aImag[i]);
        var nearElem;
    }
    function drag(elem) {
        elem.onmousedown = function (e) {
            e = e || window.event;

            var disx = e.clientX - elem.offsetLeft;
            var disy = e.clientY - elem.offsetTop;

            elem.style.zIndex = izindex;
            izindex = izindex + 1;
            document.onmousemove = function (e) {

                e = e || window.event;
                var left = e.clientX - disx;
                var top = e.clientY - disy;
                elem.style.left = left + "px";
                elem.style.top = top + "px";

                collide =[];
                for (var j = 0; j < aImag.length; j++) {

                    if (aImag[j] == elem){
                        continue;
                    }
                    var iscol = checkcollide(elem, aImag[j])
                    if (iscol) {
                        collide.push(aImag[j]);
                        console.log(collide);
                    }
                    aImag[j].className = "";
                }
                if (collide.length > 0) {
                    console.log(nearElem);
                    nearElem = nearest(elem);
                    nearElem.className = "selected";
                } else {
                    nearElem = null;
                }
                return false;
            }
            function checkcollide(elem, target) {
                var elemR = elem.offsetLeft + elem.offsetWidth;
                var targetL = target.offsetLeft;
                var elemT = elem.offsetTop + elem.offsetHeight;
                var targetT = target.offsetTop;
                var elemL = elem.offsetLeft;
                var targetR = target.offsetLeft + target.offsetWidth
                var elemB = elem.offsetTop;
                var targetB = target.offsetTop + target.offsetHeight;
                if (elemR < targetL || elemT < targetT || elemL > targetR || elemB > targetB) {
                    return false;
                } else {
                    return true;
                }
            }

            function nearest(elem) {
                var minDis = 999999999;
                var index = -1;
                for (var i = 0; i < collide.length; i++) {
                    var x = collide[i].offsetLeft - elem.offsetLeft;
                    var y = collide[i].offsetTop - elem.offsetTop;
                    var min = x * x + y * y;
                    if (min < minDis) {
                        minDis = min;
                        index = i;
                    }

                }
                return collide[index];
            }

            document.onmouseup = function () {
                document.onmousemove = null;
                if (nearElem) {
                    animate(elem, nearElem.pos);
                    animate(nearElem, elem.pos);
                    var jiaohuan = elem.pos;
                    elem.pos = nearElem.pos
                    nearElem.pos = jiaohuan;

                    nearElem.className ="";
                    nearElem = null;
                } else {
                    animate(elem, elem.pos);
                }

            }

        }
    }
</script>
</body>
</html>